(function(k){var l=window.AmazonUIPageJS||window.P,p=l._namespace||l.attributeErrors,g=p?p("ShopWithPointsCheckoutAssets",""):l;g.guardFatal?g.guardFatal(k)(g,window):g.execute(function(){k(g,window)})})(function(k,l,p){k.when("A","checkout-federation-wrapper","pay-common-util").register("rewards-section-desktop",function(g,l,k){function n(){return f("#existing-payment-methods .payment-row").filter(function(){return f(this).hasClass("payment-selected")||f(this).find("#redeemPoints").is(":checked")})}
function h(){return e.filter(".rewards-account-selected")}function m(){return q().not(".rewards-account-has-error")}function q(){return e.filter(".rewards-account-standalone")}function t(d,a){var c=d.data("paymentmethodid");c||(c=d.attr("paymentmethodid"));var c=e.filter("[data-parentpaymentmethodid\x3d"+c+"]"),c=m().filter(".rewards-user-choice").length?m().filter(".rewards-user-choice"):!c.hasClass("rewards-user-choice")&&!c.hasClass("rewards-account-is-recommended")||c.hasClass("rewards-account-has-error")?
m().filter(".rewards-account-is-recommended").length?m().filter(".rewards-account-is-recommended"):c.hasClass("rewards-account-use-by-default")&&!c.hasClass("rewards-account-has-error")?c:m().filter(".rewards-account-use-by-default").length?m().filter(".rewards-account-use-by-default").first():e.filter(".rewards-noselect"):c,b=h();b.hasClass("rewards-noselect")&&b.hasClass("rewards-user-choice")&&(c=b);r(c,!1,a)}function r(d,a,c){e.find(".rewards-input-section").hide();e.find(".rewards-warning-section").show();
e.find('input[type\x3d"radio"]').attr("disabled",!0);e.find(".rewards-info").addClass("disabled-color");var b=n().data("paymentmethodid");b||(b=n().attr("paymentmethodid"));b?(b=e.filter("[data-parentpaymentmethodid\x3d"+b+"]"),b.length&&(b.find(".rewards-warning-section").hide(),b.hasClass("rewards-account-has-error")||(b.find('input[type\x3d"radio"]').attr("disabled",!1),b.find(".rewards-info").removeClass("disabled-color"))),m().each(function(a,b){f(this).find('input[type\x3d"radio"]').attr("disabled",
!1);f(this).find(".rewards-info").removeClass("disabled-color")}),q().each(function(a,b){f(this).find(".rewards-warning-section").hide()})):d=e.filter(".rewards-noselect");e.filter(".rewards-noselect").find('input[type\x3d"radio"]').attr("disabled",!1);e.filter(".rewards-noselect").find(".rewards-info").removeClass("disabled-color");d.find(".rewards-input-section").show();d.find(".rewards-warning-section").hide();d.find('input[type\x3d"radio"]').attr("disabled",!1);d.find(".rewards-info").removeClass("disabled-color");
d.find('input[type\x3d"radio"]').attr("checked",!0);b=h();b.removeClass("rewards-account-selected");d.addClass("rewards-account-selected");a&&(b.removeClass("rewards-user-choice"),d.addClass("rewards-user-choice"));g.trigger("rewards-section:selection-changed",{$selectedAccountRow:d,device:"desktop"});c()}function u(d){e=f("#existing-payment-methods .rewards-account-row");e.filter(".rewards-account-selected-marker").removeClass("rewards-account-selected-marker").addClass("rewards-account-selected");
t(n(),d);e.unbind("click").has("input[name\x3drewardsAccount]").bind("click",function(a){!f(a.target).is(":visible")||f(a.currentTarget).find('input[type\x3d"radio"]').attr("disabled")||f(a.currentTarget).hasClass("rewards-account-selected")||(a=f(a.currentTarget),r(a,!0,d))});e.find(".rewards-input-section").undelegate("input.custom-rewards-input","keyup").delegate("input.custom-rewards-input","keyup",function(a){d();a=f(a.currentTarget);var c=a.data();if(!(0>=c.ratio)){var b=a.val()/c.ratio;isNaN(b)||
(a.val()<c.min&&(b=0),a=k.getNumberWithSeparators(b,c.decimalplaces),h().find(".custom-reward-points").html(a))}})}var f=g.$,e=f("#existing-payment-methods .rewards-account-row");g.on("rewards-section-desktop:page-load",function(d){l.wrap(function(){u(d)},"shopwithpoints")});g.on("rewards-section-desktop:select-payment-row",function(d,a){l.wrap(function(){t(d,a)},"shopwithpoints")});g.on("rewards-section-desktop:refresh-rewards-section",function(d){l.wrap(function(){null!=d&&(f("#existing-rewards-accounts-box").length?
f("#existing-rewards-accounts-box").replaceWith(d):f("#existing-credit-cards-box").after(d))},"shopwithpoints")});return{validatePaymentRewardsInRewardsSection:function(d){var a=h();if(a&&a.length&&!a.hasClass("rewards-noselect")){var a=a.find("input.custom-rewards-input"),c=a.val();if(/^\s*$/.test(c)||isNaN(c))d("continue_BadRewardsValue");else{var c=parseFloat(a.val()),b=a.data("min");0>=c||c<b?d("continue_BadRewardsMin"):c>a.data().max&&d("continue_BadRewardsMax")}}},toggleRewardsSection:r}});
k.when("A","checkout-federation-wrapper").register("rewards-section-mobile",function(g,k){function p(){var a=e("#select-payments-view .a-touch-radio:not([data-a-input-name\x3drewardsAccount])").filter("[ischecked\x3d1]");a.length||(a=e("#select-payments-view .a-touch-radio:not([data-a-input-name\x3drewardsAccount])").filter("[data-ischecked\x3d1]"));1!=a.length&&(a=e("#select-payments-view input[type\x3d'radio'][name\x3d'paymentMethod']:checked").closest(".a-touch-radio"));return a}function n(){return d.filter(".rewards-account-selected-marker")}
function h(){return m().not(".rewards-account-has-error")}function m(){return d.filter(".rewards-account-standalone")}function q(a){a=a.data("paymentmethodid");a=d.filter("[data-parentpaymentmethodid\x3d"+a+"]");a=h().filter(".rewards-user-choice").length?h().filter(".rewards-user-choice"):!a.hasClass("rewards-user-choice")&&!a.hasClass("rewards-account-is-recommended")||a.hasClass("rewards-account-has-error")?h().filter(".rewards-account-is-recommended").length?h().filter(".rewards-account-is-recommended"):
a.hasClass("rewards-account-use-by-default")&&!a.hasClass("rewards-account-has-error")?a:h().filter(".rewards-account-use-by-default").length?h().filter(".rewards-account-use-by-default").first():d.filter(".rewards-noselect"):a;var c=n();c.hasClass("rewards-noselect")&&c.hasClass("rewards-user-choice")&&(a=c);f(a,!1)}function t(a){a=e(a.currentTarget);a.find('input[type\x3d"radio"]').attr("disabled")||f(a,!0)}function r(a){a=e(a.currentTarget);var c=a.data();if(!(0>=c.ratio)){var b=a.find("input").val()/
c.ratio;isNaN(b)||(a.find("input").val()<c.min&&(b=0),a=u(b,c.decimalplaces),n().find(".custom-reward-points").html(a))}}function u(a,c){isNaN(c)||(a=Number(a).toFixed(c));a=a.toString();var b=0<=a.lastIndexOf(".")?a.lastIndexOf("."):a.length;return 3>=b?a:u(a.substring(0,b-3),0)+","+a.substring(b-3)}function f(a,c){d.find(".rewards-input-section").hide();d.find(".rewards-warning-section").show();d.find('input[type\x3d"radio"]').attr("disabled",!0);d.find("#rewards-program-name").addClass("a-color-secondary");
var b=p().data("paymentmethodid");b?(b=d.filter("[data-parentpaymentmethodid\x3d"+b+"]"),b.length&&(b.find(".rewards-warning-section").hide(),b.hasClass("rewards-account-has-error")||(b.find('input[type\x3d"radio"]').attr("disabled",!1),b.find("#rewards-program-name").removeClass("a-color-secondary"))),h().each(function(a,b){e(this).find('input[type\x3d"radio"]').attr("disabled",!1);e(this).find("#rewards-program-name").removeClass("a-color-secondary")}),m().each(function(a,b){e(this).find(".rewards-warning-section").hide()})):
a=d.filter(".rewards-noselect");b=d.filter(".rewards-noselect");b.find('input[type\x3d"radio"]').attr("disabled",!1);b.find("#rewards-program-name").removeClass("a-color-secondary");a.find(".rewards-input-section").show();a.find(".rewards-warning-section").hide();a.find('input[type\x3d"radio"]').attr("disabled",!1);a.find("#rewards-program-name").removeClass("a-color-secondary");a.find('input[type\x3d"radio"]').attr("checked",!0);b=n();b.removeClass("rewards-account-selected-marker");a.addClass("rewards-account-selected-marker");
c&&(b.removeClass("rewards-user-choice"),a.addClass("rewards-user-choice"));g.trigger("rewards-section:selection-changed",{$selectedAccountRow:a,device:"mobile"})}var e=g.$,d;g.on("rewards-section-mobile:init",function(a,c){k.wrap(function(){c.create();d=e("#select-payments-view .a-touch-radio[data-a-input-name\x3drewardsAccount]");a.undelegate(".a-touch-radio:has(input[name\x3drewardsAccount])","click").delegate(".a-touch-radio:has(input[name\x3drewardsAccount])","click",t);d.undelegate("div.custom-rewards-input",
"keyup").delegate("div.custom-rewards-input","keyup",r);q(p())},"shopwithpointsmobile")});g.on("rewards-section-mobile:select-payment-row",function(a){k.wrap(function(){q(a)},"shopwithpointsmobile")});g.on("rewards-section-mobile:refresh-rewards-section",function(a){k.wrap(function(){null!=a&&(e("#existing-rewards-accounts-box").length?e("#existing-rewards-accounts-box").replaceWith(a):e("div.payment-box").parent().after(a))},"shopwithpointsmobile")});return{validatePaymentRewardsInRewardsSection:function(a){var c=
n();if(c&&c.length&&!c.hasClass("rewards-noselect")){var c=c.find(".custom-rewards-input"),b=c.find("input").val();if(/^\s*$/.test(b)||isNaN(b))a("continue_BadRewardsValue"),e(l).scrollTop(0);else{var b=parseFloat(b),d=c.data("min");0>=b||b<d?(a("continue_BadRewardsMin"),e(l).scrollTop(0)):b>c.data().max&&(a("continue_BadRewardsMax"),e(l).scrollTop(0))}}},toggleRewardsSection:f}})});